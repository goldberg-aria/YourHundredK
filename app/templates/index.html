<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What's Your Hundred K</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="stylesheet" href="/static/css/output.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    <script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <div class="flex-shrink-0 flex items-center">
                            <h1 class="text-2xl font-bold text-gray-900">What'sYourHundredK</h1>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <button id="loginBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md text-sm font-medium">
                            ë¡œê·¸ì¸
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-xl font-semibold mb-4">íˆ¬ì ì‹œë®¬ë ˆì´ì…˜</h2>
                    
                    <!-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
                    <div class="flex justify-end mb-4">
                        <button id="refreshBtn" 
                                class="px-4 py-2 bg-red-600 text-white rounded-lg shadow hover:bg-red-700 transition-colors"
                                title="ìµœì‹  ë°ì´í„°ë¥¼ ê°•ì œë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤ (ê°œë°œìš©)">
                            ğŸ”„ ë°ì´í„° ìµœì‹ í™”
                        </button>
                    </div>
                    
                    <!-- ì…ë ¥ í¼ -->
                    <div class="grid grid-cols-1 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ì¢…ëª© ì„ íƒ</label>
                            <select id="ticker" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" onchange="updateFullName()">
                                <option value="TSLA">TSLA</option>
                                <option value="TSLY">TSLY</option>
                                <option value="KO">KO</option>
                                <option value="SCHD">SCHD</option>
                            </select>
                            <div id="ticker-fullname" class="mt-1 text-xs text-gray-500"></div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">íˆ¬ì ê¸ˆì•¡ ($)</label>
                            <input type="number" id="investment_amount" value="100000" 
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">íˆ¬ì ì‹œì‘ì¼</label>
                            <input type="date" id="start_date" 
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">íˆ¬ì ì¢…ë£Œì¼ (ì„ íƒ)</label>
                            <input type="date" id="end_date" 
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <button onclick="calculate()" 
                                    class="w-full bg-blue-500 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                ê³„ì‚°í•˜ê¸°
                            </button>
                        </div>
                    </div>

                    <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ -->
                    <div id="error" class="hidden mt-4 p-4 bg-red-50 rounded-md">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-red-800" id="error-message"></h3>
                            </div>
                        </div>
                    </div>

                    <!-- ë¡œë”© í‘œì‹œ -->
                    <div id="loading" class="hidden">
                        <div class="flex justify-center items-center py-4">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                            <span class="ml-2 text-gray-600">ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</span>
                        </div>
                    </div>

                    <!-- ê²°ê³¼ ì˜ì—­ -->
                    <div id="resultArea" class="mt-6">
                        <div id="resultContent"></div>
                        <div id="noResultMsg" class="text-center text-gray-400 py-8 hidden">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ì¡°ê±´ì„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const tickerFullNames = {
            'TSLA': 'Tesla Inc.',
            'TSLY': 'Global X Autonomous & Electric Vehicles ETF',
            'KO': 'Coca-Cola Company',
            'SCHD': 'Schwab US Dividend Equity ETF'
        };

        function updateFullName() {
            const ticker = document.getElementById('ticker').value;
            const fullNameDiv = document.getElementById('ticker-fullname');
            fullNameDiv.textContent = tickerFullNames[ticker] || '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‚ ì§œ ê¸°ë³¸ê°’ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            // ë‚ ì§œ ì…ë ¥ í•„ë“œì˜ ìµœëŒ€ê°’ì„ ì–´ì œë¡œ ì„¤ì •
            const maxDate = yesterday.toISOString().split('T')[0];
            document.getElementById('start_date').max = maxDate;
            document.getElementById('end_date').max = maxDate;
            
            // ì‹œì‘ì¼ì„ 1ë…„ ì „ìœ¼ë¡œ ì„¤ì •
            const lastYear = new Date(yesterday);
            lastYear.setFullYear(lastYear.getFullYear() - 1);
            document.getElementById('start_date').value = '2024-06-17';
            
            // ì¢…ë£Œì¼ì„ ì–´ì œë¡œ ì„¤ì •
            document.getElementById('end_date').value = '2025-06-13';
            
            // ì‹œì‘ì¼ì´ ë³€ê²½ë  ë•Œ ì¢…ë£Œì¼ ì œí•œ
            document.getElementById('start_date').addEventListener('change', function(e) {
                const startDate = new Date(e.target.value);
                const endDateInput = document.getElementById('end_date');
                endDateInput.min = e.target.value;
                
                // ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ì´ì „ì´ë©´ ì¢…ë£Œì¼ì„ ì‹œì‘ì¼ë¡œ ì„¤ì •
                if (new Date(endDateInput.value) < startDate) {
                    endDateInput.value = e.target.value;
                }
            });
            
            // ì¢…ë£Œì¼ì´ ë³€ê²½ë  ë•Œ ì‹œì‘ì¼ ì œí•œ
            document.getElementById('end_date').addEventListener('change', function(e) {
                const endDate = new Date(e.target.value);
                const startDateInput = document.getElementById('start_date');
                startDateInput.max = e.target.value;
                
                // ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ì´í›„ë©´ ì‹œì‘ì¼ì„ ì¢…ë£Œì¼ë¡œ ì„¤ì •
                if (new Date(startDateInput.value) > endDate) {
                    startDateInput.value = e.target.value;
                }
            });

            updateFullName(); // í˜ì´ì§€ ë¡œë“œ ì‹œ í’€ë„¤ì„ í‘œì‹œ
        });

        function showError(message) {
            const errorDiv = document.getElementById('error');
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function hideError() {
            const errorDiv = document.getElementById('error');
            errorDiv.classList.add('hidden');
        }

        async function calculate() {
            console.log('calculate function called');
            const ticker = document.getElementById('ticker').value;
            const investment_amount = document.getElementById('investment_amount').value;
            const start_date = document.getElementById('start_date').value;
            const end_date = document.getElementById('end_date').value;
            const loading = document.getElementById('loading');
            
            console.log('Form values:', { ticker, investment_amount, start_date, end_date });
            
            hideError();
            loading.classList.remove('hidden');
            
            try {
                // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                console.log('Fetching stock data...');
                const fetchResponse = await fetch('/api/fetch-stock-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ticker, start_date, end_date })
                });
                const fetchData = await fetchResponse.json();
                console.log('Fetch response:', fetchResponse.status, fetchData);
                
                if (!fetchResponse.ok) {
                    throw new Error(fetchData.error || 'ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                // ìˆ˜ìµë¥  ê³„ì‚°
                console.log('Calculating returns...');
                const response = await fetch('/api/calculate-returns', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ticker, investment_amount, start_date, end_date })
                });
                const data = await response.json();
                console.log('Calculate response:', response.status, data);
                
                loading.classList.add('hidden');
                showResult(data);
            } catch (error) {
                console.error('Error in calculate function:', error);
                showError(error.message);
                loading.classList.add('hidden');
            }
        }

        async function refreshData() {
            const ticker = document.getElementById('ticker').value;
            const start_date = document.getElementById('start_date').value;
            const end_date = document.getElementById('end_date').value;
            const loading = document.getElementById('loading');
            hideError();
            loading.classList.remove('hidden');
            try {
                const fetchResponse = await fetch('/api/fetch-stock-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ticker, start_date, end_date, force_refresh: true })
                });
                const fetchData = await fetchResponse.json();
                if (!fetchResponse.ok) {
                    throw new Error(fetchData.error || 'ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                loading.classList.add('hidden');
                alert('ë°ì´í„°ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
            } catch (error) {
                showError(error.message);
                loading.classList.add('hidden');
            }
        }

        function showResult(data) {
            console.log('showResult called with data:', data);
            const resultContent = document.getElementById('resultContent');
            const noResultMsg = document.getElementById('noResultMsg');
            
            if (!data || data.error) {
                console.log('No data or error found, showing no result message');
                resultContent.innerHTML = '';
                noResultMsg.classList.remove('hidden');
            } else {
                console.log('Rendering result data');
                
                // ê²°ê³¼ HTML ìƒì„±
                const resultHTML = `
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-4">
                        <h3 class="text-lg font-semibold text-blue-900 mb-4">íˆ¬ì ê²°ê³¼</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">ì´ˆê¸° íˆ¬ìê¸ˆ</div>
                                <div class="text-xl font-bold text-gray-900">$${data.initial_investment.toLocaleString()}</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">í˜„ì¬ ê°€ì¹˜</div>
                                <div class="text-xl font-bold text-gray-900">$${data.current_value.toLocaleString()}</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">ì´ ìˆ˜ìµë¥ </div>
                                <div class="text-xl font-bold ${data.total_return_percentage >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${data.total_return_percentage.toFixed(2)}%
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">ì´ ë°°ë‹¹ê¸ˆ</div>
                                <div class="text-xl font-bold text-gray-900">$${data.total_dividends.toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="mt-4 text-sm text-gray-600">
                            <div>ë³´ìœ  ì£¼ì‹ ìˆ˜: ${data.shares_owned.toFixed(2)}ì£¼</div>
                            <div>ê¸°ê°„: ${data.start_date} ~ ${data.end_date}</div>
                            <div>ì‹œì‘ê°€: $${data.initial_price.toFixed(2)} | ì¢…ê°€: $${data.final_price.toFixed(2)}</div>
                        </div>
                    </div>
                `;
                
                resultContent.innerHTML = resultHTML;
                noResultMsg.classList.add('hidden');
                
                // ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ í‘œì‹œ
                if (data.chart) {
                    const chartDiv = document.createElement('div');
                    chartDiv.innerHTML = data.chart;
                    resultContent.appendChild(chartDiv);
                }
                
                console.log('Result rendered successfully');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('refreshBtn').addEventListener('click', refreshData);
        });
    </script>
</body>
</html> 