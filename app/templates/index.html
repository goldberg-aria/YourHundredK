<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What's Your Hundred K</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="stylesheet" href="/static/css/output.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    <script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <div class="flex-shrink-0 flex items-center">
                            <h1 class="text-2xl font-bold text-gray-900">What'sYourHundredK</h1>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <button id="loginBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md text-sm font-medium">
                            ë¡œê·¸ì¸
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-xl font-semibold mb-4">íˆ¬ì ì‹œë®¬ë ˆì´ì…˜</h2>
                    
                    <!-- ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ -->
                    <div class="flex justify-end mb-4">
                        <button id="refreshBtn" 
                                class="px-4 py-2 bg-red-600 text-white rounded-lg shadow hover:bg-red-700 transition-colors"
                                title="ìµœì‹  ë°ì´í„°ë¥¼ ê°•ì œë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤ (ê°œë°œìš©)">
                            ğŸ”„ ë°ì´í„° ìµœì‹ í™”
                        </button>
                    </div>
                    
                    <!-- ì…ë ¥ í¼ -->
                    <div class="grid grid-cols-1 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì¸ê¸° ì¢…ëª© ë¹ ë¥¸ ì„ íƒ</label>
                            
                            <!-- ì¸ê¸° ë°°ë‹¹ì£¼ -->
                            <div class="mb-4">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">ğŸ¢ ì¸ê¸° ë°°ë‹¹ì£¼</h3>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="selectTicker('AAPL')" 
                                            class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-sm font-medium border border-blue-200 hover:border-blue-300 transition-all duration-200 cursor-pointer shadow-sm hover:shadow-md"
                                            style="display: inline-block; background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500;">
                                        AAPL
                                    </button>
                                    <button onclick="selectTicker('JNJ')" 
                                            class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-sm font-medium border border-blue-200 hover:border-blue-300 transition-all duration-200 cursor-pointer shadow-sm hover:shadow-md"
                                            style="display: inline-block; background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500;">
                                        JNJ
                                    </button>
                                    <button onclick="selectTicker('KO')" 
                                            class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-sm font-medium border border-blue-200 hover:border-blue-300 transition-all duration-200 cursor-pointer shadow-sm hover:shadow-md"
                                            style="display: inline-block; background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500;">
                                        KO
                                    </button>
                                    <button onclick="selectTicker('PG')" 
                                            class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-sm font-medium border border-blue-200 hover:border-blue-300 transition-all duration-200 cursor-pointer shadow-sm hover:shadow-md"
                                            style="display: inline-block; background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500;">
                                        PG
                                    </button>
                                    <button onclick="selectTicker('ABBV')" 
                                            class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-sm font-medium border border-blue-200 hover:border-blue-300 transition-all duration-200 cursor-pointer shadow-sm hover:shadow-md"
                                            style="display: inline-block; background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500;">
                                        ABBV
                                    </button>
                                </div>
                            </div>
                            
                            <!-- ì¸ê¸° ë°°ë‹¹ ETF -->
                            <div class="mb-4">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">ğŸ“ˆ ì¸ê¸° ë°°ë‹¹ ETF</h3>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="selectTicker('SCHD')" style="display: inline-block; background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">SCHD</button>
                                    <button onclick="selectTicker('VYM')" style="display: inline-block; background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">VYM</button>
                                    <button onclick="selectTicker('JEPI')" style="display: inline-block; background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">JEPI</button>
                                    <button onclick="selectTicker('DIVO')" style="display: inline-block; background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">DIVO</button>
                                    <button onclick="selectTicker('HDV')" style="display: inline-block; background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">HDV</button>
                                </div>
                            </div>
                            
                            <!-- ì¸ê¸° ì»¤ë²„ë“œì½œ ETF -->
                            <div class="mb-4">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">ğŸ¯ ì¸ê¸° ì»¤ë²„ë“œì½œ ETF</h3>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="selectTicker('QYLD')" style="display: inline-block; background-color: #f3e8ff; color: #6b21a8; border: 1px solid #e9d5ff; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">QYLD</button>
                                    <button onclick="selectTicker('XYLD')" style="display: inline-block; background-color: #f3e8ff; color: #6b21a8; border: 1px solid #e9d5ff; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">XYLD</button>
                                    <button onclick="selectTicker('RYLD')" style="display: inline-block; background-color: #f3e8ff; color: #6b21a8; border: 1px solid #e9d5ff; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">RYLD</button>
                                    <button onclick="selectTicker('JEPQ')" style="display: inline-block; background-color: #f3e8ff; color: #6b21a8; border: 1px solid #e9d5ff; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">JEPQ</button>
                                    <button onclick="selectTicker('QYLG')" style="display: inline-block; background-color: #f3e8ff; color: #6b21a8; border: 1px solid #e9d5ff; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">QYLG</button>
                                </div>
                            </div>

                            <!-- ì¸ê¸° ê°œë³„ì¢…ëª© ì»¤ë²„ë“œì½œ -->
                            <div class="mb-4">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">ğŸŒŸ ì¸ê¸° ê°œë³„ì¢…ëª© ì»¤ë²„ë“œì½œ</h3>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="selectTicker('TSLY')" style="display: inline-block; background-color: #fed7aa; color: #c2410c; border: 1px solid #fdba74; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">TSLY</button>
                                    <button onclick="selectTicker('NVDY')" style="display: inline-block; background-color: #fed7aa; color: #c2410c; border: 1px solid #fdba74; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">NVDY</button>
                                    <button onclick="selectTicker('CONY')" style="display: inline-block; background-color: #fed7aa; color: #c2410c; border: 1px solid #fdba74; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">CONY</button>
                                    <button onclick="selectTicker('GOOY')" style="display: inline-block; background-color: #fed7aa; color: #c2410c; border: 1px solid #fdba74; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">GOOY</button>
                                    <button onclick="selectTicker('APLY')" style="display: inline-block; background-color: #fed7aa; color: #c2410c; border: 1px solid #fdba74; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">APLY</button>
                                </div>
                            </div>

                            <div class="mt-4">
                                <label class="block text-sm font-medium text-gray-700">ì§ì ‘ ì…ë ¥</label>
                                <div class="mt-1 flex rounded-md shadow-sm">
                                    <input type="text" id="ticker" 
                                           class="flex-1 rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"
                                           placeholder="ì˜ˆ: AAPL, MSFT, GOOGL"
                                           onchange="updateFullName()">
                                </div>
                                <div id="ticker-fullname" class="mt-1 text-xs text-gray-500"></div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">íˆ¬ì ê¸ˆì•¡ ($)</label>
                            <input type="number" id="investment_amount" value="100000" 
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">íˆ¬ì ì‹œì‘ì¼</label>
                            <input type="date" id="start_date" 
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">íˆ¬ì ì¢…ë£Œì¼ (ì„ íƒ)</label>
                            <input type="date" id="end_date" 
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <button onclick="calculate()" 
                                    class="w-full bg-blue-500 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                ê³„ì‚°í•˜ê¸°
                            </button>
                        </div>
                    </div>

                    <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ -->
                    <div id="error" class="hidden mt-4 p-4 bg-red-50 rounded-md">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-red-800" id="error-message"></h3>
                            </div>
                        </div>
                    </div>

                    <!-- ë¡œë”© í‘œì‹œ -->
                    <div id="loading" class="hidden">
                        <div class="flex justify-center items-center py-4">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                            <span class="ml-2 text-gray-600">ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</span>
                        </div>
                    </div>

                    <!-- ì¸í„°ë™í‹°ë¸Œ ì°¨íŠ¸ ì˜ì—­ -->
                    <div id="chartArea" class="mt-6 mb-6">
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-xl font-bold text-gray-900 flex items-center">
                                    ğŸ“ˆ ì£¼ê°€ ì°¨íŠ¸
                                    <span class="ml-2 text-sm font-normal text-gray-600">(ì°¨íŠ¸ì—ì„œ ì§ì ‘ ì„¤ì • ë³€ê²½ ê°€ëŠ¥)</span>
                                </h3>
                                <div class="flex space-x-2">
                                    <button onclick="updateChart()" 
                                            class="px-3 py-1 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition-colors">
                                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                                    </button>
                                </div>
                            </div>
                            <div id="interactiveChart" class="w-full h-96 bg-white rounded-lg shadow-inner border border-gray-200"></div>
                            <div class="mt-4 p-3 bg-blue-100 rounded-lg">
                                <div class="text-sm text-blue-800">
                                    ğŸ’¡ <strong>ì°¨íŠ¸ ì‚¬ìš©ë²•:</strong> 
                                    <ul class="mt-1 ml-4 list-disc list-inside space-y-1">
                                        <li>ì°¨íŠ¸ í•˜ë‹¨ì˜ ìŠ¬ë¼ì´ë”ë¡œ ë‚ ì§œ ë²”ìœ„ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                                        <li>ìƒë‹¨: ì£¼ê°€ ë¼ì¸ê³¼ ê±°ë˜ëŸ‰ ë°” ì°¨íŠ¸</li>
                                        <li>ì¤‘ê°„: ğŸ’° ë°°ë‹¹ê¸ˆ ë§‰ëŒ€ê·¸ë˜í”„ (ì‹¤ì œ ë°°ë‹¹ê¸ˆì•¡)</li>
                                        <li>í•˜ë‹¨: ğŸ“Š ë°°ë‹¹ìˆ˜ìµë¥  ë§‰ëŒ€ê·¸ë˜í”„ (ë°°ë‹¹ê¸ˆ/ì£¼ê°€ ë¹„ìœ¨)</li>
                                        <li>ì°¨íŠ¸ ìš°ìƒë‹¨ì˜ ë„êµ¬ë¡œ ì¤Œ, íŒ¬, ì´ë¯¸ì§€ ì €ì¥ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ê²°ê³¼ ì˜ì—­ -->
                    <div id="resultArea" class="mt-6">
                        <div id="resultContent"></div>
                        <div id="noResultMsg" class="text-center text-gray-400 py-8 hidden">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ì¡°ê±´ì„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const tickerFullNames = {
            // ì¸ê¸° ë°°ë‹¹ì£¼
            'AAPL': 'Apple Inc. - ê¸°ìˆ ì£¼ì˜ ëŒ€í‘œì ì¸ ë°°ë‹¹ì„±ì¥ì£¼',
            'JNJ': 'Johnson & Johnson - í—¬ìŠ¤ì¼€ì–´ ì„¹í„° ë°°ë‹¹ê·€ì¡±',
            'KO': 'Coca-Cola Company - ì†Œë¹„ì¬ ì„¹í„° ë°°ë‹¹ê·€ì¡±',
            'PG': 'Procter & Gamble - ìƒí™œìš©í’ˆ ì„¹í„° ë°°ë‹¹ê·€ì¡±',
            'ABBV': 'AbbVie Inc. - ë†’ì€ ë°°ë‹¹ìˆ˜ìµë¥ ì˜ ì œì•½íšŒì‚¬',
            
            // ì¸ê¸° ë°°ë‹¹ ETF
            'SCHD': 'Schwab US Dividend Equity ETF - ë°°ë‹¹ ì„±ì¥ ì¤‘ì‹¬ ETF',
            'VYM': 'Vanguard High Dividend Yield ETF - ì•ˆì •ì ì¸ ê³ ë°°ë‹¹ ETF',
            'JEPI': 'JPMorgan Equity Premium Income ETF - ì›”ë°°ë‹¹ + ì˜µì…˜ í”„ë¦¬ë¯¸ì—„',
            'DIVO': 'Amplify CWP Enhanced Dividend Income ETF - ë°°ë‹¹ ì„±ì¥ + ì˜µì…˜ ì „ëµ',
            'HDV': 'iShares Core High Dividend ETF - ê³ ë°°ë‹¹ + í€„ë¦¬í‹° ETF',
            
            // ì¸ê¸° ì»¤ë²„ë“œì½œ ETF
            'QYLD': 'Global X NASDAQ-100 Covered Call ETF - ë‚˜ìŠ¤ë‹¥ 100 ì»¤ë²„ë“œì½œ',
            'XYLD': 'Global X S&P 500 Covered Call ETF - S&P 500 ì»¤ë²„ë“œì½œ',
            'RYLD': 'Global X Russell 2000 Covered Call ETF - ëŸ¬ì…€ 2000 ì»¤ë²„ë“œì½œ',
            'JEPQ': 'JPMorgan Nasdaq Equity Premium Income ETF - ë‚˜ìŠ¤ë‹¥ í”„ë¦¬ë¯¸ì—„ ì¸ì»´',
            'QYLG': 'Global X Nasdaq 100 Covered Call & Growth ETF - ë¶€ë¶„ ì»¤ë²„ë“œì½œ',
            
            // ì¸ê¸° ê°œë³„ì¢…ëª© ì»¤ë²„ë“œì½œ
            'TSLY': 'YieldMax TSLA Option Income Strategy ETF - í…ŒìŠ¬ë¼ ì»¤ë²„ë“œì½œ',
            'NVDY': 'YieldMax NVDA Option Income Strategy ETF - ì—”ë¹„ë””ì•„ ì»¤ë²„ë“œì½œ',
            'CONY': 'YieldMax COIN Option Income Strategy ETF - ì½”ì¸ë² ì´ìŠ¤ ì»¤ë²„ë“œì½œ',
            'GOOY': 'YieldMax GOOGL Option Income Strategy ETF - êµ¬ê¸€ ì»¤ë²„ë“œì½œ',
            'APLY': 'YieldMax AAPL Option Income Strategy ETF - ì• í”Œ ì»¤ë²„ë“œì½œ'
        };

        let currentChartData = null;
        let isUpdatingFromChart = false;
        const DEFAULT_TICKER = 'KO';  // ê¸°ë³¸ ì¢…ëª©ì„ ì½”ì¹´ì½œë¼ë¡œ ì„¤ì •

        function selectTicker(ticker) {
            document.getElementById('ticker').value = ticker;
            updateFullName();
            fetchDataAndUpdateChart();
        }

        function updateFullName() {
            const ticker = document.getElementById('ticker').value;
            const fullNameDiv = document.getElementById('ticker-fullname');
            fullNameDiv.textContent = tickerFullNames[ticker] || '';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ë‚ ì§œ ê¸°ë³¸ê°’ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            // ë‚ ì§œ ì…ë ¥ í•„ë“œì˜ ìµœëŒ€ê°’ì„ ì–´ì œë¡œ ì„¤ì •
            const maxDate = yesterday.toISOString().split('T')[0];
            document.getElementById('start_date').max = maxDate;
            document.getElementById('end_date').max = maxDate;
            
            // ì‹œì‘ì¼ì„ 1ë…„ ì „ìœ¼ë¡œ ì„¤ì •
            const lastYear = new Date(yesterday);
            lastYear.setFullYear(lastYear.getFullYear() - 1);
            document.getElementById('start_date').value = lastYear.toISOString().split('T')[0];
            
            // ì¢…ë£Œì¼ì„ ì–´ì œë¡œ ì„¤ì •
            document.getElementById('end_date').value = maxDate;
            
            // ê¸°ë³¸ ì¢…ëª© ì„¤ì • ë° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            document.getElementById('ticker').value = DEFAULT_TICKER;
            updateFullName();
            fetchDataAndUpdateChart();
            
            // ì‹œì‘ì¼ì´ ë³€ê²½ë  ë•Œ ì¢…ë£Œì¼ ì œí•œ ë° ë°ì´í„° ì—…ë°ì´íŠ¸
            document.getElementById('start_date').addEventListener('change', function(e) {
                if (!isUpdatingFromChart) {
                    const startDate = new Date(e.target.value);
                    const endDateInput = document.getElementById('end_date');
                    endDateInput.min = e.target.value;
                    
                    // ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ì´ì „ì´ë©´ ì¢…ë£Œì¼ì„ ì‹œì‘ì¼ë¡œ ì„¤ì •
                    if (new Date(endDateInput.value) < startDate) {
                        endDateInput.value = e.target.value;
                    }
                    
                    // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë° ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                    fetchDataAndUpdateChart();
                }
            });

            // ì¢…ë£Œì¼ì´ ë³€ê²½ë  ë•Œ ë°ì´í„° ì—…ë°ì´íŠ¸
            document.getElementById('end_date').addEventListener('change', function() {
                if (!isUpdatingFromChart) {
                    fetchDataAndUpdateChart();
                }
            });

            // ì¢…ëª© ì§ì ‘ ì…ë ¥ ì‹œ ë°ì´í„° ì—…ë°ì´íŠ¸
            document.getElementById('ticker').addEventListener('change', function() {
                if (!isUpdatingFromChart) {
                    fetchDataAndUpdateChart();
                }
            });
        });

        async function fetchDataAndUpdateChart() {
            const ticker = document.getElementById('ticker').value;
            if (!ticker) return;

            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            const investmentAmount = document.getElementById('investment_amount').value;

            // ë¡œë”© í‘œì‹œ
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('error').classList.add('hidden');

            try {
                // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ìš”ì²­
                const response = await fetch('/api/get-chart-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ticker: ticker,
                        investment_amount: parseFloat(investmentAmount),
                        start_date: startDate,
                        end_date: endDate,
                        force_refresh: true  // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê°•ì œë¡œ ê°€ì ¸ì˜¤ê¸°
                    })
                });

                if (!response.ok) {
                    throw new Error('ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤');
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                currentChartData = data;
                updateChart();

            } catch (error) {
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-message').textContent = error.message;
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        function updateChart() {
            if (!currentChartData) return;
            
            const chartDiv = document.getElementById('interactiveChart');

            // ë³´ìœ ì£¼ì‹ìˆ˜ ê³„ì‚° (íˆ¬ìê¸ˆ/ì‹œì‘ê°€)
            const investmentAmount = parseFloat(document.getElementById('investment_amount').value);
            const initialPrice = currentChartData.prices.length > 0 ? currentChartData.prices[0] : 1;
            const shares = investmentAmount / initialPrice;

            // ì£¼ê°€ ì°¨íŠ¸ (ë¼ì¸)
            const trace1 = {
                x: currentChartData.dates,
                y: currentChartData.prices,
                type: 'scatter',
                mode: 'lines',
                name: 'ì£¼ê°€',
                line: { 
                    color: '#1E40AF', 
                    width: 3,
                    shape: 'spline'
                },
                fill: 'tonexty',
                fillcolor: 'rgba(30, 64, 175, 0.08)',
                hovertemplate: '<b>%{x}</b><br>ì£¼ê°€: $%{y:,.2f}<extra></extra>',
                yaxis: 'y'
            };

            // ë°°ë‹¹ê¸ˆ bar
            const dividendDates = [];
            const dividendAmounts = [];
            const dividendTotal = [];
            const dividendYields = [];
            currentChartData.dividends.forEach((dividend, index) => {
                if (dividend > 0) {
                    const currentPrice = currentChartData.prices[index];
                    dividendDates.push(currentChartData.dates[index]);
                    dividendAmounts.push(dividend);
                    dividendTotal.push(dividend * shares);
                    dividendYields.push((dividend / currentPrice) * 100);
                }
            });

            // Yì¶• ë²”ìœ„ ê³„ì‚°
            const prices = currentChartData.prices;
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const priceRange = maxPrice - minPrice;
            const ymin = minPrice - (priceRange * 0.1); // ìµœì €ê°€ì˜ -10%
            const ymax = maxPrice + (priceRange * 0.1); // ìµœê³ ê°€ì˜ +10%

            const trace2 = {
                x: dividendDates,
                y: dividendTotal,  // ë°°ë‹¹ ì´ì•¡ ì‚¬ìš©
                type: 'bar',
                name: 'ë°°ë‹¹ê¸ˆ ì´ì•¡',
                marker: {
                    color: 'rgba(16, 185, 129, 0.7)',
                    line: { color: '#059669', width: 1 }
                },
                width: 24 * 60 * 60 * 1000, // 1ì¼ ë„“ì´ (ms)
                hovertemplate: '<b>%{x}</b><br>ì£¼ë‹¹ ë°°ë‹¹ê¸ˆ: $%{customdata[0]:.4f}<br>ë³´ìœ ì£¼ì‹ìˆ˜: %{customdata[1]:.2f}ì£¼<br>ì´ ë°°ë‹¹ê¸ˆ: <b>$%{y:,.2f}</b><br>ì‹œê°€ë°°ë‹¹ë¥ : %{customdata[2]:.2f}%<extra></extra>',
                customdata: dividendAmounts.map((amt, i) => [amt, shares, dividendYields[i]]),
                yaxis: 'y2'  // ë‘ ë²ˆì§¸ yì¶• ì‚¬ìš©
            };

            const layout = {
                title: {
                    text: `${currentChartData.ticker} ì£¼ê°€ & ë°°ë‹¹ ë¶„ì„`,
                    font: { 
                        size: 22, 
                        color: '#1F2937',
                        family: 'Inter, system-ui, sans-serif'
                    },
                    x: 0.5,
                    xanchor: 'center'
                },
                xaxis: {
                    title: {
                        text: 'ë‚ ì§œ',
                        font: { size: 14, color: '#374151' }
                    },
                    rangeslider: { 
                        visible: true,
                        thickness: 0.05,
                        bgcolor: 'rgba(156, 163, 175, 0.1)'
                    },
                    type: 'date',
                    gridcolor: 'rgba(156, 163, 175, 0.1)',
                    showgrid: true
                },
                yaxis: {
                    title: {
                        text: 'ì£¼ê°€ ($)',
                        font: { size: 14, color: '#1E40AF' }
                    },
                    tickformat: ',.2f',
                    gridcolor: 'rgba(156, 163, 175, 0.1)',
                    showgrid: true,
                    zeroline: false,
                    side: 'left',
                    range: [ymin, ymax]  // Yì¶• ë²”ìœ„ ì„¤ì •
                },
                yaxis2: {
                    title: {
                        text: 'ë°°ë‹¹ê¸ˆ ì´ì•¡ ($)',
                        font: { size: 14, color: '#059669' }
                    },
                    tickformat: ',.2f',
                    gridcolor: 'rgba(156, 163, 175, 0.1)',
                    showgrid: false,
                    zeroline: false,
                    overlaying: 'y',
                    side: 'right'
                },
                hovermode: 'x unified',
                showlegend: true,
                legend: {
                    x: 0.02,
                    y: 0.98,
                    bgcolor: 'rgba(255,255,255,0.95)',
                    bordercolor: '#E5E7EB',
                    borderwidth: 1,
                    font: { size: 12 }
                },
                margin: { l: 60, r: 80, t: 80, b: 100 },  // ì˜¤ë¥¸ìª½ ì—¬ë°± ì¦ê°€
                plot_bgcolor: '#F8FAFC',
                paper_bgcolor: '#F1F5F9',
                font: { 
                    color: '#374151',
                    family: 'Inter, system-ui, sans-serif'
                },
                transition: {
                    duration: 500,
                    easing: 'cubic-in-out'
                }
            };

            const config = {
                responsive: true,
                displayModeBar: true,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'],
                displaylogo: false,
                toImageButtonOptions: {
                    format: 'png',
                    filename: `${currentChartData.ticker}_chart`,
                    height: 800,
                    width: 1200,
                    scale: 2
                }
            };

            Plotly.newPlot(chartDiv, [trace1, trace2], layout, config);

            // ì°¨íŠ¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            chartDiv.on('plotly_relayout', function(eventData) {
                if (eventData['xaxis.range[0]'] && eventData['xaxis.range[1]']) {
                    const startDate = new Date(eventData['xaxis.range[0]']).toISOString().split('T')[0];
                    const endDate = new Date(eventData['xaxis.range[1]']).toISOString().split('T')[0];
                    
                    isUpdatingFromChart = true;
                    document.getElementById('start_date').value = startDate;
                    document.getElementById('end_date').value = endDate;
                    isUpdatingFromChart = false;
                }
            });

            // ì°¨íŠ¸ ë¡œë”© ì™„ë£Œ í›„ ì• ë‹ˆë©”ì´ì…˜
            chartDiv.on('plotly_afterplot', function() {
                chartDiv.style.opacity = '0';
                setTimeout(() => {
                    chartDiv.style.transition = 'opacity 0.5s ease-in-out';
                    chartDiv.style.opacity = '1';
                }, 100);
            });
        }

        async function calculate() {
            const ticker = document.getElementById('ticker').value;
            if (!ticker) {
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-message').textContent = 'ì¢…ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.';
                return;
            }

            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            const investmentAmount = parseFloat(document.getElementById('investment_amount').value);

            if (!startDate || !endDate || isNaN(investmentAmount) || investmentAmount <= 0) {
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-message').textContent = 'ëª¨ë“  ì…ë ¥ê°’ì„ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                return;
            }

            // ë¡œë”© í‘œì‹œ
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('resultContent').innerHTML = '';
            document.getElementById('noResultMsg').classList.add('hidden');

            try {
                const response = await fetch('/api/calculate-returns', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ticker: ticker,
                        investment_amount: investmentAmount,
                        start_date: startDate,
                        end_date: endDate
                    })
                });

                if (!response.ok) {
                    throw new Error('ìˆ˜ìµë¥  ê³„ì‚°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }

                // ê²°ê³¼ í‘œì‹œ
                const resultContent = document.getElementById('resultContent');
                resultContent.innerHTML = `
                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 shadow-lg border border-green-200">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">ğŸ“Š íˆ¬ì ê²°ê³¼ ë¶„ì„</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ì´ˆê¸° íˆ¬ìê¸ˆ</span>
                                    <span class="font-semibold">$${result.investment_amount.toLocaleString('en-US', {minimumFractionDigits: 2})}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ë³´ìœ  ì£¼ì‹ìˆ˜</span>
                                    <span class="font-semibold">${result.shares.toLocaleString('en-US', {minimumFractionDigits: 2})} ì£¼</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ë§¤ìˆ˜ ê°€ê²©</span>
                                    <span class="font-semibold">$${result.initial_price.toLocaleString('en-US', {minimumFractionDigits: 2})}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">í˜„ì¬ ê°€ê²©</span>
                                    <span class="font-semibold">$${result.final_price.toLocaleString('en-US', {minimumFractionDigits: 2})}</span>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ìë³¸ ì´ë“</span>
                                    <span class="font-semibold ${result.capital_gains >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${result.capital_gains >= 0 ? '+' : ''}$${result.capital_gains.toLocaleString('en-US', {minimumFractionDigits: 2})}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ë°°ë‹¹ê¸ˆ ì´ì•¡</span>
                                    <span class="font-semibold text-green-600">
                                        +$${result.total_dividends.toLocaleString('en-US', {minimumFractionDigits: 2})}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ì›” í‰ê·  ë°°ë‹¹ê¸ˆ</span>
                                    <span class="font-semibold text-green-600">
                                        +$${result.monthly_dividend.toLocaleString('en-US', {minimumFractionDigits: 2})}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ì´ ìˆ˜ìµ</span>
                                    <span class="font-semibold ${result.total_return >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${result.total_return >= 0 ? '+' : ''}$${result.total_return.toLocaleString('en-US', {minimumFractionDigits: 2})}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ì´ ìˆ˜ìµë¥ </span>
                                    <span class="font-semibold ${result.total_return_percentage >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${result.total_return_percentage >= 0 ? '+' : ''}${result.total_return_percentage.toFixed(2)}%
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ì—°ê°„ ë°°ë‹¹ë¥ </span>
                                    <span class="font-semibold text-green-600">${result.dividend_yield.toFixed(2)}%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ë³´ìœ  ê¸°ê°„</span>
                                    <span class="font-semibold">${result.months_held.toFixed(1)}ê°œì›”</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-message').textContent = error.message;
                document.getElementById('noResultMsg').classList.remove('hidden');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        async function refreshData() {
            const ticker = document.getElementById('ticker').value;
            const start_date = document.getElementById('start_date').value;
            const end_date = document.getElementById('end_date').value;
            const loading = document.getElementById('loading');
            hideError();
            loading.classList.remove('hidden');
            try {
                const fetchResponse = await fetch('/api/fetch-stock-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ticker, start_date, end_date, force_refresh: true })
                });
                const fetchData = await fetchResponse.json();
                if (!fetchResponse.ok) {
                    throw new Error(fetchData.error || 'ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                loading.classList.add('hidden');
                alert('ë°ì´í„°ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¤ì‹œ ê³„ì‚°í•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
                updateChart(); // ì°¨íŠ¸ë„ ì—…ë°ì´íŠ¸
            } catch (error) {
                showError(error.message);
                loading.classList.add('hidden');
            }
        }

        function showResult(data) {
            console.log('showResult called with data:', data);
            const resultContent = document.getElementById('resultContent');
            const noResultMsg = document.getElementById('noResultMsg');
            
            if (!data || data.error) {
                console.log('No data or error found, showing no result message');
                resultContent.innerHTML = '';
                noResultMsg.classList.remove('hidden');
            } else {
                console.log('Rendering result data');
                
                // ê²°ê³¼ HTML ìƒì„±
                const resultHTML = `
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-4">
                        <h3 class="text-lg font-semibold text-blue-900 mb-4">íˆ¬ì ê²°ê³¼</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">ì´ˆê¸° íˆ¬ìê¸ˆ</div>
                                <div class="text-xl font-bold text-gray-900">$${data.initial_investment.toLocaleString()}</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">í˜„ì¬ ê°€ì¹˜</div>
                                <div class="text-xl font-bold text-gray-900">$${data.current_value.toLocaleString()}</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">ì´ ìˆ˜ìµë¥ </div>
                                <div class="text-xl font-bold ${data.total_return_percentage >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${data.total_return_percentage.toFixed(2)}%
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">ì´ ë°°ë‹¹ê¸ˆ</div>
                                <div class="text-xl font-bold text-gray-900">$${data.total_dividends.toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="mt-4 text-sm text-gray-600">
                            <div>ë³´ìœ  ì£¼ì‹ ìˆ˜: ${data.shares_owned.toFixed(2)}ì£¼</div>
                            <div>ê¸°ê°„: ${data.start_date} ~ ${data.end_date}</div>
                            <div>ì‹œì‘ê°€: $${data.initial_price.toFixed(2)} | ì¢…ê°€: $${data.final_price.toFixed(2)}</div>
                        </div>
                    </div>
                `;
                
                resultContent.innerHTML = resultHTML;
                noResultMsg.classList.add('hidden');
                
                // ì°¨íŠ¸ê°€ ìˆìœ¼ë©´ í‘œì‹œ
                if (data.chart) {
                    const chartDiv = document.createElement('div');
                    chartDiv.innerHTML = data.chart;
                    resultContent.appendChild(chartDiv);
                }
                
                console.log('Result rendered successfully');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('refreshBtn').addEventListener('click', refreshData);
        });
    </script>
</body>
</html> 