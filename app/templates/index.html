<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What's Your Hundred K</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="stylesheet" href="/static/css/output.css">
    <link rel="stylesheet" href="/static/css/styles.css">
    <script src="https://cdn.plot.ly/plotly-2.29.1.min.js"></script>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen">
        <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î∞î -->
        <nav class="bg-white shadow-lg">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <div class="flex-shrink-0 flex items-center">
                            <h1 class="text-2xl font-bold text-gray-900">What'sYourHundredK</h1>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <button id="loginBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md text-sm font-medium">
                            Î°úÍ∑∏Ïù∏
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Î©îÏù∏ Ïª®ÌÖêÏ∏† -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-xl font-semibold mb-4">Ìà¨Ïûê ÏãúÎÆ¨Î†àÏù¥ÏÖò</h2>
                    
                    <!-- ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäº -->
                    <div class="flex justify-end mb-4">
                        <button id="refreshBtn" 
                                class="px-4 py-2 bg-red-600 text-white rounded-lg shadow hover:bg-red-700 transition-colors"
                                title="ÏµúÏã† Îç∞Ïù¥ÌÑ∞Î•º Í∞ïÏ†úÎ°ú Í∞ÄÏ†∏ÏòµÎãàÎã§ (Í∞úÎ∞úÏö©)">
                            üîÑ Îç∞Ïù¥ÌÑ∞ ÏµúÏã†Ìôî
                        </button>
                    </div>
                    
                    <!-- ÏûÖÎ†• Ìèº -->
                    <div class="grid grid-cols-1 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ïù∏Í∏∞ Ï¢ÖÎ™© Îπ†Î•∏ ÏÑ†ÌÉù</label>
                            
                            <!-- Ïù∏Í∏∞ Î∞∞ÎãπÏ£º -->
                            <div class="mb-4">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">üè¢ Ïù∏Í∏∞ Î∞∞ÎãπÏ£º</h3>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="selectTicker('AAPL')" 
                                            class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-sm font-medium border border-blue-200 hover:border-blue-300 transition-all duration-200 cursor-pointer shadow-sm hover:shadow-md"
                                            style="display: inline-block; background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500;">
                                        AAPL
                                    </button>
                                    <button onclick="selectTicker('JNJ')" 
                                            class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-sm font-medium border border-blue-200 hover:border-blue-300 transition-all duration-200 cursor-pointer shadow-sm hover:shadow-md"
                                            style="display: inline-block; background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500;">
                                        JNJ
                                    </button>
                                    <button onclick="selectTicker('KO')" 
                                            class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-sm font-medium border border-blue-200 hover:border-blue-300 transition-all duration-200 cursor-pointer shadow-sm hover:shadow-md"
                                            style="display: inline-block; background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500;">
                                        KO
                                    </button>
                                    <button onclick="selectTicker('PG')" 
                                            class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-sm font-medium border border-blue-200 hover:border-blue-300 transition-all duration-200 cursor-pointer shadow-sm hover:shadow-md"
                                            style="display: inline-block; background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500;">
                                        PG
                                    </button>
                                    <button onclick="selectTicker('ABBV')" 
                                            class="px-4 py-2 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-full text-sm font-medium border border-blue-200 hover:border-blue-300 transition-all duration-200 cursor-pointer shadow-sm hover:shadow-md"
                                            style="display: inline-block; background-color: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500;">
                                        ABBV
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Ïù∏Í∏∞ Î∞∞Îãπ ETF -->
                            <div class="mb-4">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">üìà Ïù∏Í∏∞ Î∞∞Îãπ ETF</h3>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="selectTicker('SCHD')" style="display: inline-block; background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">SCHD</button>
                                    <button onclick="selectTicker('VYM')" style="display: inline-block; background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">VYM</button>
                                    <button onclick="selectTicker('JEPI')" style="display: inline-block; background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">JEPI</button>
                                    <button onclick="selectTicker('DIVO')" style="display: inline-block; background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">DIVO</button>
                                    <button onclick="selectTicker('HDV')" style="display: inline-block; background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">HDV</button>
                                </div>
                            </div>
                            
                            <!-- Ïù∏Í∏∞ Ïª§Î≤ÑÎìúÏΩú ETF -->
                            <div class="mb-4">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">üéØ Ïù∏Í∏∞ Ïª§Î≤ÑÎìúÏΩú ETF</h3>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="selectTicker('QYLD')" style="display: inline-block; background-color: #f3e8ff; color: #6b21a8; border: 1px solid #e9d5ff; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">QYLD</button>
                                    <button onclick="selectTicker('XYLD')" style="display: inline-block; background-color: #f3e8ff; color: #6b21a8; border: 1px solid #e9d5ff; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">XYLD</button>
                                    <button onclick="selectTicker('RYLD')" style="display: inline-block; background-color: #f3e8ff; color: #6b21a8; border: 1px solid #e9d5ff; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">RYLD</button>
                                    <button onclick="selectTicker('JEPQ')" style="display: inline-block; background-color: #f3e8ff; color: #6b21a8; border: 1px solid #e9d5ff; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">JEPQ</button>
                                    <button onclick="selectTicker('QYLG')" style="display: inline-block; background-color: #f3e8ff; color: #6b21a8; border: 1px solid #e9d5ff; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">QYLG</button>
                                </div>
                            </div>

                            <!-- Ïù∏Í∏∞ Í∞úÎ≥ÑÏ¢ÖÎ™© Ïª§Î≤ÑÎìúÏΩú -->
                            <div class="mb-4">
                                <h3 class="text-sm font-semibold text-gray-600 mb-2">üåü Ïù∏Í∏∞ Í∞úÎ≥ÑÏ¢ÖÎ™© Ïª§Î≤ÑÎìúÏΩú</h3>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="selectTicker('TSLY')" style="display: inline-block; background-color: #fed7aa; color: #c2410c; border: 1px solid #fdba74; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">TSLY</button>
                                    <button onclick="selectTicker('NVDY')" style="display: inline-block; background-color: #fed7aa; color: #c2410c; border: 1px solid #fdba74; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">NVDY</button>
                                    <button onclick="selectTicker('CONY')" style="display: inline-block; background-color: #fed7aa; color: #c2410c; border: 1px solid #fdba74; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">CONY</button>
                                    <button onclick="selectTicker('GOOY')" style="display: inline-block; background-color: #fed7aa; color: #c2410c; border: 1px solid #fdba74; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">GOOY</button>
                                    <button onclick="selectTicker('APLY')" style="display: inline-block; background-color: #fed7aa; color: #c2410c; border: 1px solid #fdba74; border-radius: 9999px; padding: 8px 16px; font-size: 14px; font-weight: 500; cursor: pointer;">APLY</button>
                                </div>
                            </div>

                            <div class="mt-4">
                                <label class="block text-sm font-medium text-gray-700">ÏßÅÏ†ë ÏûÖÎ†•</label>
                                <div class="mt-1 flex rounded-md shadow-sm">
                                    <input type="text" id="ticker" 
                                           class="flex-1 rounded-md border-gray-300 focus:border-blue-500 focus:ring-blue-500"
                                           placeholder="Ïòà: AAPL, MSFT, GOOGL"
                                           onchange="updateFullName()">
                                </div>
                                <div id="ticker-fullname" class="mt-1 text-xs text-gray-500"></div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Ìà¨Ïûê Í∏àÏï° ($)</label>
                            <input type="number" id="investment_amount" value="100000" 
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Ìà¨Ïûê ÏãúÏûëÏùº</label>
                            <input type="date" id="start_date" 
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Ìà¨Ïûê Ï¢ÖÎ£åÏùº (ÏÑ†ÌÉù)</label>
                            <input type="date" id="end_date" 
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        
                        <div>
                            <button onclick="calculate()" 
                                    class="w-full bg-blue-500 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                Í≥ÑÏÇ∞ÌïòÍ∏∞
                            </button>
                        </div>
                    </div>

                    <!-- Ïò§Î•ò Î©îÏãúÏßÄ -->
                    <div id="error" class="hidden mt-4 p-4 bg-red-50 rounded-md">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-red-800" id="error-message"></h3>
                            </div>
                        </div>
                    </div>

                    <!-- Î°úÎî© ÌëúÏãú -->
                    <div id="loading" class="hidden">
                        <div class="flex justify-center items-center py-4">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                            <span class="ml-2 text-gray-600">Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë...</span>
                        </div>
                    </div>

                    <!-- Ïù∏ÌÑ∞ÎûôÌã∞Î∏å Ï∞®Ìä∏ ÏòÅÏó≠ -->
                    <div id="chartArea" class="mt-6 mb-6">
                        <div class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6 shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-xl font-bold text-gray-900 flex items-center">
                                    üìà Ï£ºÍ∞Ä Ï∞®Ìä∏
                                    <span class="ml-2 text-sm font-normal text-gray-600">(Ï∞®Ìä∏ÏóêÏÑú ÏßÅÏ†ë ÏÑ§Ï†ï Î≥ÄÍ≤Ω Í∞ÄÎä•)</span>
                                </h3>
                                <div class="flex space-x-2">
                                    <button onclick="updateChart()" 
                                            class="px-3 py-1 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition-colors">
                                        üîÑ ÏÉàÎ°úÍ≥†Ïπ®
                                    </button>
                                </div>
                            </div>
                            <div id="interactiveChart" class="w-full h-96 bg-white rounded-lg shadow-inner border border-gray-200"></div>
                            <div class="mt-4 p-3 bg-blue-100 rounded-lg">
                                <div class="text-sm text-blue-800">
                                    üí° <strong>Ï∞®Ìä∏ ÏÇ¨Ïö©Î≤ï:</strong> 
                                    <ul class="mt-1 ml-4 list-disc list-inside space-y-1">
                                        <li>Ï∞®Ìä∏ ÌïòÎã®Ïùò Ïä¨ÎùºÏù¥ÎçîÎ°ú ÎÇ†Ïßú Î≤îÏúÑÎ•º Ï°∞Ï†ïÌï† Ïàò ÏûàÏäµÎãàÎã§</li>
                                        <li>ÏÉÅÎã®: Ï£ºÍ∞Ä ÎùºÏù∏Í≥º Í±∞ÎûòÎüâ Î∞î Ï∞®Ìä∏</li>
                                        <li>Ï§ëÍ∞Ñ: üí∞ Î∞∞ÎãπÍ∏à ÎßâÎåÄÍ∑∏ÎûòÌîÑ (Ïã§Ï†ú Î∞∞ÎãπÍ∏àÏï°)</li>
                                        <li>ÌïòÎã®: üìä Î∞∞ÎãπÏàòÏùµÎ•† ÎßâÎåÄÍ∑∏ÎûòÌîÑ (Î∞∞ÎãπÍ∏à/Ï£ºÍ∞Ä ÎπÑÏú®)</li>
                                        <li>Ï∞®Ìä∏ Ïö∞ÏÉÅÎã®Ïùò ÎèÑÍµ¨Î°ú Ï§å, Ìå¨, Ïù¥ÎØ∏ÏßÄ Ï†ÄÏû•Ïù¥ Í∞ÄÎä•Ìï©ÎãàÎã§</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Í≤∞Í≥º ÏòÅÏó≠ -->
                    <div id="resultArea" class="mt-6">
                        <div id="resultContent"></div>
                        <div id="noResultMsg" class="text-center text-gray-400 py-8 hidden">Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§. Ï°∞Í±¥ÏùÑ Îã§Ïãú ÌôïÏù∏Ìï¥ Ï£ºÏÑ∏Ïöî.</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const tickerFullNames = {
            // Ïù∏Í∏∞ Î∞∞ÎãπÏ£º
            'AAPL': 'Apple Inc. - Í∏∞Ïà†Ï£ºÏùò ÎåÄÌëúÏ†ÅÏù∏ Î∞∞ÎãπÏÑ±Ïû•Ï£º',
            'JNJ': 'Johnson & Johnson - Ìó¨Ïä§ÏºÄÏñ¥ ÏÑπÌÑ∞ Î∞∞ÎãπÍ∑ÄÏ°±',
            'KO': 'Coca-Cola Company - ÏÜåÎπÑÏû¨ ÏÑπÌÑ∞ Î∞∞ÎãπÍ∑ÄÏ°±',
            'PG': 'Procter & Gamble - ÏÉùÌôúÏö©Ìíà ÏÑπÌÑ∞ Î∞∞ÎãπÍ∑ÄÏ°±',
            'ABBV': 'AbbVie Inc. - ÎÜíÏùÄ Î∞∞ÎãπÏàòÏùµÎ•†Ïùò Ï†úÏïΩÌöåÏÇ¨',
            
            // Ïù∏Í∏∞ Î∞∞Îãπ ETF
            'SCHD': 'Schwab US Dividend Equity ETF - Î∞∞Îãπ ÏÑ±Ïû• Ï§ëÏã¨ ETF',
            'VYM': 'Vanguard High Dividend Yield ETF - ÏïàÏ†ïÏ†ÅÏù∏ Í≥†Î∞∞Îãπ ETF',
            'JEPI': 'JPMorgan Equity Premium Income ETF - ÏõîÎ∞∞Îãπ + ÏòµÏÖò ÌîÑÎ¶¨ÎØ∏ÏóÑ',
            'DIVO': 'Amplify CWP Enhanced Dividend Income ETF - Î∞∞Îãπ ÏÑ±Ïû• + ÏòµÏÖò Ï†ÑÎûµ',
            'HDV': 'iShares Core High Dividend ETF - Í≥†Î∞∞Îãπ + ÌÄÑÎ¶¨Ìã∞ ETF',
            
            // Ïù∏Í∏∞ Ïª§Î≤ÑÎìúÏΩú ETF
            'QYLD': 'Global X NASDAQ-100 Covered Call ETF - ÎÇòÏä§Îã• 100 Ïª§Î≤ÑÎìúÏΩú',
            'XYLD': 'Global X S&P 500 Covered Call ETF - S&P 500 Ïª§Î≤ÑÎìúÏΩú',
            'RYLD': 'Global X Russell 2000 Covered Call ETF - Îü¨ÏÖÄ 2000 Ïª§Î≤ÑÎìúÏΩú',
            'JEPQ': 'JPMorgan Nasdaq Equity Premium Income ETF - ÎÇòÏä§Îã• ÌîÑÎ¶¨ÎØ∏ÏóÑ Ïù∏Ïª¥',
            'QYLG': 'Global X Nasdaq 100 Covered Call & Growth ETF - Î∂ÄÎ∂Ñ Ïª§Î≤ÑÎìúÏΩú',
            
            // Ïù∏Í∏∞ Í∞úÎ≥ÑÏ¢ÖÎ™© Ïª§Î≤ÑÎìúÏΩú
            'TSLY': 'YieldMax TSLA Option Income Strategy ETF - ÌÖåÏä¨Îùº Ïª§Î≤ÑÎìúÏΩú',
            'NVDY': 'YieldMax NVDA Option Income Strategy ETF - ÏóîÎπÑÎîîÏïÑ Ïª§Î≤ÑÎìúÏΩú',
            'CONY': 'YieldMax COIN Option Income Strategy ETF - ÏΩîÏù∏Î≤†Ïù¥Ïä§ Ïª§Î≤ÑÎìúÏΩú',
            'GOOY': 'YieldMax GOOGL Option Income Strategy ETF - Íµ¨Í∏Ä Ïª§Î≤ÑÎìúÏΩú',
            'APLY': 'YieldMax AAPL Option Income Strategy ETF - Ïï†Ìîå Ïª§Î≤ÑÎìúÏΩú'
        };

        let currentChartData = null;
        let isUpdatingFromChart = false;
        const DEFAULT_TICKER = 'KO';  // Í∏∞Î≥∏ Ï¢ÖÎ™©ÏùÑ ÏΩîÏπ¥ÏΩúÎùºÎ°ú ÏÑ§Ï†ï

        function selectTicker(ticker) {
            document.getElementById('ticker').value = ticker;
            updateFullName();
            fetchDataAndUpdateChart();
        }

        function updateFullName() {
            const ticker = document.getElementById('ticker').value;
            const fullNameDiv = document.getElementById('ticker-fullname');
            fullNameDiv.textContent = tickerFullNames[ticker] || '';
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÎÇ†Ïßú Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            // ÎÇ†Ïßú ÏûÖÎ†• ÌïÑÎìúÏùò ÏµúÎåÄÍ∞íÏùÑ Ïñ¥Ï†úÎ°ú ÏÑ§Ï†ï
            const maxDate = yesterday.toISOString().split('T')[0];
            document.getElementById('start_date').max = maxDate;
            document.getElementById('end_date').max = maxDate;
            
            // ÏãúÏûëÏùºÏùÑ 1ÎÖÑ Ï†ÑÏúºÎ°ú ÏÑ§Ï†ï
            const lastYear = new Date(yesterday);
            lastYear.setFullYear(lastYear.getFullYear() - 1);
            document.getElementById('start_date').value = lastYear.toISOString().split('T')[0];
            
            // Ï¢ÖÎ£åÏùºÏùÑ Ïñ¥Ï†úÎ°ú ÏÑ§Ï†ï
            document.getElementById('end_date').value = maxDate;
            
            // Í∏∞Î≥∏ Ï¢ÖÎ™© ÏÑ§Ï†ï Î∞è Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
            document.getElementById('ticker').value = DEFAULT_TICKER;
            updateFullName();
            fetchDataAndUpdateChart();
            
            // ÏãúÏûëÏùºÏù¥ Î≥ÄÍ≤ΩÎê† Îïå Ï¢ÖÎ£åÏùº Ï†úÌïú Î∞è Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('start_date').addEventListener('change', function(e) {
                if (!isUpdatingFromChart) {
                    const startDate = new Date(e.target.value);
                    const endDateInput = document.getElementById('end_date');
                    endDateInput.min = e.target.value;
                    
                    // Ï¢ÖÎ£åÏùºÏù¥ ÏãúÏûëÏùºÎ≥¥Îã§ Ïù¥Ï†ÑÏù¥Î©¥ Ï¢ÖÎ£åÏùºÏùÑ ÏãúÏûëÏùºÎ°ú ÏÑ§Ï†ï
                    if (new Date(endDateInput.value) < startDate) {
                        endDateInput.value = e.target.value;
                    }
                    
                    // Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ Î∞è Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
                    fetchDataAndUpdateChart();
                }
            });

            // Ï¢ÖÎ£åÏùºÏù¥ Î≥ÄÍ≤ΩÎê† Îïå Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('end_date').addEventListener('change', function() {
                if (!isUpdatingFromChart) {
                    fetchDataAndUpdateChart();
                }
            });

            // Ï¢ÖÎ™© ÏßÅÏ†ë ÏûÖÎ†• Ïãú Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('ticker').addEventListener('change', function() {
                if (!isUpdatingFromChart) {
                    fetchDataAndUpdateChart();
                }
            });
        });

        async function fetchDataAndUpdateChart() {
            const ticker = document.getElementById('ticker').value;
            if (!ticker) return;

            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            const investmentAmount = document.getElementById('investment_amount').value;

            // Î°úÎî© ÌëúÏãú
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('error').classList.add('hidden');

            try {
                // Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ ÏöîÏ≤≠
                const response = await fetch('/api/get-chart-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ticker: ticker,
                        investment_amount: parseFloat(investmentAmount),
                        start_date: startDate,
                        end_date: endDate,
                        force_refresh: true  // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Í∞ïÏ†úÎ°ú Í∞ÄÏ†∏Ïò§Í∏∞
                    })
                });

                if (!response.ok) {
                    throw new Error('Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§');
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                // Ï∞®Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏
                currentChartData = data;
                updateChart();

            } catch (error) {
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-message').textContent = error.message;
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        function updateChart() {
            if (!currentChartData) return;
            
            const chartDiv = document.getElementById('interactiveChart');

            // Î≥¥Ïú†Ï£ºÏãùÏàò Í≥ÑÏÇ∞ (Ìà¨ÏûêÍ∏à/ÏãúÏûëÍ∞Ä)
            const investmentAmount = parseFloat(document.getElementById('investment_amount').value);
            const initialPrice = currentChartData.prices.length > 0 ? currentChartData.prices[0] : 1;
            const shares = investmentAmount / initialPrice;

            // Ï£ºÍ∞Ä Ï∞®Ìä∏ (ÎùºÏù∏)
            const trace1 = {
                x: currentChartData.dates,
                y: currentChartData.prices,
                type: 'scatter',
                mode: 'lines',
                name: 'Ï£ºÍ∞Ä',
                line: { 
                    color: '#1E40AF', 
                    width: 3,
                    shape: 'spline'
                },
                fill: 'tonexty',
                fillcolor: 'rgba(30, 64, 175, 0.08)',
                hovertemplate: '<b>%{x}</b><br>Ï£ºÍ∞Ä: $%{y:,.2f}<extra></extra>',
                yaxis: 'y'
            };

            // Î∞∞ÎãπÍ∏à bar
            const dividendDates = [];
            const dividendAmounts = [];
            const dividendTotal = [];
            const dividendYields = [];
            currentChartData.dividends.forEach((dividend, index) => {
                if (dividend > 0) {
                    const currentPrice = currentChartData.prices[index];
                    dividendDates.push(currentChartData.dates[index]);
                    dividendAmounts.push(dividend);
                    dividendTotal.push(dividend * shares);
                    dividendYields.push((dividend / currentPrice) * 100);
                }
            });

            // YÏ∂ï Î≤îÏúÑ Í≥ÑÏÇ∞
            const prices = currentChartData.prices;
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const priceRange = maxPrice - minPrice;
            const ymin = minPrice - (priceRange * 0.1); // ÏµúÏ†ÄÍ∞ÄÏùò -10%
            const ymax = maxPrice + (priceRange * 0.1); // ÏµúÍ≥†Í∞ÄÏùò +10%

            const trace2 = {
                x: dividendDates,
                y: dividendTotal,  // Î∞∞Îãπ Ï¥ùÏï° ÏÇ¨Ïö©
                type: 'bar',
                name: 'Î∞∞ÎãπÍ∏à Ï¥ùÏï°',
                marker: {
                    color: 'rgba(16, 185, 129, 0.7)',
                    line: { color: '#059669', width: 1 }
                },
                width: 24 * 60 * 60 * 1000, // 1Ïùº ÎÑìÏù¥ (ms)
                hovertemplate: '<b>%{x}</b><br>Ï£ºÎãπ Î∞∞ÎãπÍ∏à: $%{customdata[0]:.4f}<br>Î≥¥Ïú†Ï£ºÏãùÏàò: %{customdata[1]:.2f}Ï£º<br>Ï¥ù Î∞∞ÎãπÍ∏à: <b>$%{y:,.2f}</b><br>ÏãúÍ∞ÄÎ∞∞ÎãπÎ•†: %{customdata[2]:.2f}%<extra></extra>',
                customdata: dividendAmounts.map((amt, i) => [amt, shares, dividendYields[i]]),
                yaxis: 'y2'  // Îëê Î≤àÏß∏ yÏ∂ï ÏÇ¨Ïö©
            };

            const layout = {
                title: {
                    text: `${currentChartData.ticker} Ï£ºÍ∞Ä & Î∞∞Îãπ Î∂ÑÏÑù`,
                    font: { 
                        size: 22, 
                        color: '#1F2937',
                        family: 'Inter, system-ui, sans-serif'
                    },
                    x: 0.5,
                    xanchor: 'center'
                },
                xaxis: {
                    title: {
                        text: 'ÎÇ†Ïßú',
                        font: { size: 14, color: '#374151' }
                    },
                    rangeslider: { 
                        visible: true,
                        thickness: 0.05,
                        bgcolor: 'rgba(156, 163, 175, 0.1)'
                    },
                    type: 'date',
                    gridcolor: 'rgba(156, 163, 175, 0.1)',
                    showgrid: true
                },
                yaxis: {
                    title: {
                        text: 'Ï£ºÍ∞Ä ($)',
                        font: { size: 14, color: '#1E40AF' }
                    },
                    tickformat: ',.2f',
                    gridcolor: 'rgba(156, 163, 175, 0.1)',
                    showgrid: true,
                    zeroline: false,
                    side: 'left',
                    range: [ymin, ymax]  // YÏ∂ï Î≤îÏúÑ ÏÑ§Ï†ï
                },
                yaxis2: {
                    title: {
                        text: 'Î∞∞ÎãπÍ∏à Ï¥ùÏï° ($)',
                        font: { size: 14, color: '#059669' }
                    },
                    tickformat: ',.2f',
                    gridcolor: 'rgba(156, 163, 175, 0.1)',
                    showgrid: false,
                    zeroline: false,
                    overlaying: 'y',
                    side: 'right'
                },
                hovermode: 'x unified',
                showlegend: true,
                legend: {
                    x: 0.02,
                    y: 0.98,
                    bgcolor: 'rgba(255,255,255,0.95)',
                    bordercolor: '#E5E7EB',
                    borderwidth: 1,
                    font: { size: 12 }
                },
                margin: { l: 60, r: 80, t: 80, b: 100 },  // Ïò§Î•∏Ï™Ω Ïó¨Î∞± Ï¶ùÍ∞Ä
                plot_bgcolor: '#F8FAFC',
                paper_bgcolor: '#F1F5F9',
                font: { 
                    color: '#374151',
                    family: 'Inter, system-ui, sans-serif'
                },
                transition: {
                    duration: 500,
                    easing: 'cubic-in-out'
                }
            };

            const config = {
                responsive: true,
                displayModeBar: true,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'],
                displaylogo: false,
                toImageButtonOptions: {
                    format: 'png',
                    filename: `${currentChartData.ticker}_chart`,
                    height: 800,
                    width: 1200,
                    scale: 2
                }
            };

            Plotly.newPlot(chartDiv, [trace1, trace2], layout, config);

            // Ï∞®Ìä∏ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
            chartDiv.on('plotly_relayout', function(eventData) {
                if (eventData['xaxis.range[0]'] && eventData['xaxis.range[1]']) {
                    const startDate = new Date(eventData['xaxis.range[0]']).toISOString().split('T')[0];
                    const endDate = new Date(eventData['xaxis.range[1]']).toISOString().split('T')[0];
                    
                    isUpdatingFromChart = true;
                    document.getElementById('start_date').value = startDate;
                    document.getElementById('end_date').value = endDate;
                    isUpdatingFromChart = false;
                }
            });

            // Ï∞®Ìä∏ Î°úÎî© ÏôÑÎ£å ÌõÑ Ïï†ÎãàÎ©îÏù¥ÏÖò
            chartDiv.on('plotly_afterplot', function() {
                chartDiv.style.opacity = '0';
                setTimeout(() => {
                    chartDiv.style.transition = 'opacity 0.5s ease-in-out';
                    chartDiv.style.opacity = '1';
                }, 100);
            });
        }

        async function calculate() {
            const ticker = document.getElementById('ticker').value;
            if (!ticker) {
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-message').textContent = 'Ï¢ÖÎ™©ÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.';
                return;
            }

            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;
            const investmentAmount = parseFloat(document.getElementById('investment_amount').value);

            if (!startDate || !endDate || isNaN(investmentAmount) || investmentAmount <= 0) {
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-message').textContent = 'Î™®Îì† ÏûÖÎ†•Í∞íÏùÑ Ïò¨Î∞îÎ•¥Í≤å ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
                return;
            }

            // Î°úÎî© ÌëúÏãú
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('error').classList.add('hidden');
            document.getElementById('resultContent').innerHTML = '';
            document.getElementById('noResultMsg').classList.add('hidden');

            try {
                const response = await fetch('/api/calculate-returns', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        ticker: ticker,
                        investment_amount: investmentAmount,
                        start_date: startDate,
                        end_date: endDate
                    })
                });

                if (!response.ok) {
                    throw new Error('ÏàòÏùµÎ•† Í≥ÑÏÇ∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }

                const result = await response.json();
                
                if (result.error) {
                    throw new Error(result.error);
                }

                // Í≤∞Í≥º ÌëúÏãú
                const resultContent = document.getElementById('resultContent');
                resultContent.innerHTML = `
                    <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6 shadow-lg border border-green-200">
                        <h3 class="text-xl font-bold text-gray-900 mb-4">üìä Ìà¨Ïûê Í≤∞Í≥º Î∂ÑÏÑù</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Ï¥àÍ∏∞ Ìà¨ÏûêÍ∏à</span>
                                    <span class="font-semibold">$${result.investment_amount.toLocaleString('en-US', {minimumFractionDigits: 2})}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Î≥¥Ïú† Ï£ºÏãùÏàò</span>
                                    <span class="font-semibold">${result.shares.toLocaleString('en-US', {minimumFractionDigits: 2})} Ï£º</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Îß§Ïàò Í∞ÄÍ≤©</span>
                                    <span class="font-semibold">$${result.initial_price.toLocaleString('en-US', {minimumFractionDigits: 2})}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ÌòÑÏû¨ Í∞ÄÍ≤©</span>
                                    <span class="font-semibold">$${result.final_price.toLocaleString('en-US', {minimumFractionDigits: 2})}</span>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">ÏûêÎ≥∏ Ïù¥Îìù</span>
                                    <span class="font-semibold ${result.capital_gains >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${result.capital_gains >= 0 ? '+' : ''}$${result.capital_gains.toLocaleString('en-US', {minimumFractionDigits: 2})}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Î∞∞ÎãπÍ∏à Ï¥ùÏï°</span>
                                    <span class="font-semibold text-green-600">
                                        +$${result.total_dividends.toLocaleString('en-US', {minimumFractionDigits: 2})}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Ïõî ÌèâÍ∑† Î∞∞ÎãπÍ∏à</span>
                                    <span class="font-semibold text-green-600">
                                        +$${result.monthly_dividend.toLocaleString('en-US', {minimumFractionDigits: 2})}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Ï¥ù ÏàòÏùµ</span>
                                    <span class="font-semibold ${result.total_return >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${result.total_return >= 0 ? '+' : ''}$${result.total_return.toLocaleString('en-US', {minimumFractionDigits: 2})}
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Ï¥ù ÏàòÏùµÎ•†</span>
                                    <span class="font-semibold ${result.total_return_percentage >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ${result.total_return_percentage >= 0 ? '+' : ''}${result.total_return_percentage.toFixed(2)}%
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Ïó∞Í∞Ñ Î∞∞ÎãπÎ•†</span>
                                    <span class="font-semibold text-green-600">${result.dividend_yield.toFixed(2)}%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Î≥¥Ïú† Í∏∞Í∞Ñ</span>
                                    <span class="font-semibold">${result.months_held.toFixed(1)}Í∞úÏõî</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

            } catch (error) {
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-message').textContent = error.message;
                document.getElementById('noResultMsg').classList.remove('hidden');
            } finally {
                document.getElementById('loading').classList.add('hidden');
            }
        }

        async function refreshData() {
            const ticker = document.getElementById('ticker').value;
            const start_date = document.getElementById('start_date').value;
            const end_date = document.getElementById('end_date').value;
            const loading = document.getElementById('loading');
            hideError();
            loading.classList.remove('hidden');
            try {
                const fetchResponse = await fetch('/api/fetch-stock-data', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ticker, start_date, end_date, force_refresh: true })
                });
                const fetchData = await fetchResponse.json();
                if (!fetchResponse.ok) {
                    throw new Error(fetchData.error || 'Îç∞Ïù¥ÌÑ∞Î•º ÏÉàÎ°úÍ≥†Ïπ®ÌïòÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
                loading.classList.add('hidden');
                alert('Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÉàÎ°úÍ≥†Ïπ®ÎêòÏóàÏäµÎãàÎã§! Îã§Ïãú Í≥ÑÏÇ∞ÌïòÍ∏∞Î•º ÎàåÎü¨Ï£ºÏÑ∏Ïöî.');
                updateChart(); // Ï∞®Ìä∏ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
            } catch (error) {
                showError(error.message);
                loading.classList.add('hidden');
            }
        }

        function showResult(data) {
            console.log('showResult called with data:', data);
            const resultContent = document.getElementById('resultContent');
            const noResultMsg = document.getElementById('noResultMsg');
            
            if (!data || data.error) {
                console.log('No data or error found, showing no result message');
                resultContent.innerHTML = '';
                noResultMsg.classList.remove('hidden');
            } else {
                console.log('Rendering result data');
                
                // Í≤∞Í≥º HTML ÏÉùÏÑ±
                const resultHTML = `
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-4">
                        <h3 class="text-lg font-semibold text-blue-900 mb-4">Ìà¨Ïûê Í≤∞Í≥º</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">Ï¥àÍ∏∞ Ìà¨ÏûêÍ∏à</div>
                                <div class="text-xl font-bold text-gray-900">$${data.initial_investment.toLocaleString()}</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">ÌòÑÏû¨ Í∞ÄÏπò</div>
                                <div class="text-xl font-bold text-gray-900">$${data.current_value.toLocaleString()}</div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">Ï¥ù ÏàòÏùµÎ•†</div>
                                <div class="text-xl font-bold ${data.total_return_percentage >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${data.total_return_percentage.toFixed(2)}%
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-sm">
                                <div class="text-sm text-gray-600">Ï¥ù Î∞∞ÎãπÍ∏à</div>
                                <div class="text-xl font-bold text-gray-900">$${data.total_dividends.toLocaleString()}</div>
                            </div>
                        </div>
                        <div class="mt-4 text-sm text-gray-600">
                            <div>Î≥¥Ïú† Ï£ºÏãù Ïàò: ${data.shares_owned.toFixed(2)}Ï£º</div>
                            <div>Í∏∞Í∞Ñ: ${data.start_date} ~ ${data.end_date}</div>
                            <div>ÏãúÏûëÍ∞Ä: $${data.initial_price.toFixed(2)} | Ï¢ÖÍ∞Ä: $${data.final_price.toFixed(2)}</div>
                        </div>
                    </div>
                `;
                
                resultContent.innerHTML = resultHTML;
                noResultMsg.classList.add('hidden');
                
                // Ï∞®Ìä∏Í∞Ä ÏûàÏúºÎ©¥ ÌëúÏãú
                if (data.chart) {
                    const chartDiv = document.createElement('div');
                    chartDiv.innerHTML = data.chart;
                    resultContent.appendChild(chartDiv);
                }
                
                console.log('Result rendered successfully');
            }
        }

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('refreshBtn').addEventListener('click', refreshData);
        });
    </script>
</body>
</html> 